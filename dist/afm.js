!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).afm={})}(this,(function(e){"use strict";function n(e){return JSON.parse(JSON.stringify(e))}function t(e){return e.replace(/[\-\[\]{}()*+?.,\\\^\$|#]/g,"\\$&")}e.afm=function(e="",r="extension",i=((e="")=>e),s={},o={}){const c=e.includes("\r")?"\r\n":"\n",l=e.match(/(?<!\\|\>\s*)```[^```]+\\?```(\r?\n)?/g)||[],f=Array.from(new Set(e.match(/\&#\w+;/g)||[])),p=f.map((e=>escape(e))),a=l.reduce(((e,n)=>e.replace(n,"")),n(e)),d=f.reduce(((e,n)=>e.replace(new RegExp(t(n),"g"),escape(n))),a).match(/(?!\r?\n)(\s+|\t+)?\>\[\!.*\r?\n((\s+|\t+)?\>(?!\[\!).*\r?\n?){1,}/g)||[],u=Object.keys(s).filter((e=>"VIDEO"===s[e]))[0]||"VIDEO",g=new RegExp(`(?<!\`\`\`\\r?\\n(\\s+|\\t+)?)\\>\\[\\!${u}\\]\\((.*)\\)`,"g");let $=n(e);for(const e of d){const n=e.split(/\r?\n/).filter((e=>e.length>0&&/[^\s]+/.test(e))),a=(n[0].match(/\>\[\!(.*)\]/)||[])[1]||"",d=n[0].replace(/\>\[.*/,""),u=`${c}${d}`,g=`${d}${i(n.slice(1,n.length).map((e=>{let n=e.replace(/^(\s+|\t+)?\>/,"").trim();for(const e of f)n.includes(e)&&(n=n.replace(new RegExp(t(e),"g"),escape(e)));return n})).filter(((e,n)=>0!==n||e.length>0)).join(c).trim()).split(/\r?\n/).join(u)}`,m=(a in s?s[a]:a).toLowerCase().replace(/\s/g,""),h=n.map((e=>{let n=e;for(const e of p)n.includes(e)&&(n=n.replace(new RegExp(t(e),"g"),unescape(e)));return n})).join(c);let x=$.indexOf(h);if(l.length>0){let e=0;const n=l.filter((e=>e.includes(h))).map((n=>{const t=$.indexOf(n,e)+n.indexOf(h);return t>e&&(e=t),t}));if(n.includes(x))for(;n.includes(x);)x=$.indexOf(h,x+1)}$=`${$.slice(0,x)}${d}<div class="${r} ${m}">${u}<div>${a in o?o[a]:a}</div>${u}<div>${c}${g.replace(/\r?\n$/,"")}${u}</div>${u}</div>${u}${$.slice(x+h.length)}`}$=$.replace(g,`<div class="${r} video"><iframe allowfullscreen embedded-video src="$2" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"><source src="$2" type="" /><p>Your browser does not support the iframe element.</p></iframe></div>`);for(const e of p)$=$.replace(new RegExp(t(e),"g"),unescape(e));return $.trim()},Object.defineProperty(e,"__esModule",{value:!0})}));