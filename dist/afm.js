!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).afm={})}(this,(function(e){"use strict";function t(e){return e.replace(/[\-\[\]{}()*+?.,\\\^\$|#]/g,"\\$&")}e.afm=function(e="",n="extension",r=((e="")=>e),o={},i={}){const s=e.includes("\r")?"\r\n":"\n",c=e.match(/(?<!\>\s*)\/?```[^\/?```]+\/?```/g)||[],l=Array.from(new Set(e.match(/\&#\w+;/g)||[])),p=l.map((e=>escape(e))),a=c.reduce(((e,t)=>e.replace(t,"")),e.toString()),f=l.reduce(((e,n)=>e.replace(new RegExp(t(n),"g"),escape(n))),a).match(/(?!\r?\n)(\s+|\t+)?\>\[\!.*\r?\n((\s+|\t+)?\>(?!\[\!).*\r?\n?){1,}/g)||[],d=Object.keys(o).filter((e=>"VIDEO"===o[e]))[0]||"VIDEO",u=new RegExp(`(?<!\`\`\`\\r?\\n(\\s+|\\t+)?)\\>\\[\\!${d}\\]\\((.*)\\)`,"g");let g=e.toString();for(const e of f){const c=e.split(/\r?\n/).filter((e=>e.length>0&&/[^\s]+/.test(e))),a=(c[0].match(/\>\[\!(.*)\]/)||[])[1]||"",f=c[0].replace(/\>\[.*/,""),d=`${s}${f}`,u=`${f}${r(c.slice(1,c.length).map((e=>{let n=e.replace(/^(\s+|\t+)?\>/,"").trim();for(const e of l)n.includes(e)&&(n=n.replace(new RegExp(t(e),"g"),escape(e)));return n})).filter(((e,t)=>0!==t||e.length>0)).join(s).trim()).split(/\r?\n/).join(d)}`,$=(a in o?o[a]:a).toLowerCase().replace(/\s/g,""),m=c.map((e=>{let n=e;for(const e of p)n.includes(e)&&(n=n.replace(new RegExp(t(e),"g"),unescape(e)));return n})).join(s);g=g.replace(m,`${f}<div class="${n} ${$}">${d}<div>${a in i?i[a]:a}</div>${d}<div>${s}${u.replace(/\r?\n$/,"")}${d}</div>${d}</div>`)}g=g.replace(u,`<div class="${n} video"><iframe allowfullscreen embedded-video src="$2" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"><source src="$2" type="" /><p>Your browser does not support the iframe element.</p></iframe></div>`);for(const e of p)g=g.replace(new RegExp(t(e),"g"),unescape(e));return g.trim()},Object.defineProperty(e,"__esModule",{value:!0})}));