!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).afm={})}(this,(function(e){"use strict";function t(e=""){return JSON.parse(JSON.stringify(e))}function n(e=""){return e.replace(/[\-\[\]{}()*+?.,\\\^\$|#]/g,"\\$&")}function r(e="",t="",n=[],r=0){let i=0,s=r;const c=n.filter((t=>t.includes(e))).map((n=>{const r=t.indexOf(n,i)+n.indexOf(e);return r>i&&(i=r),r}));if(c.includes(s))for(;c.includes(s);)s=t.indexOf(e,s+1);return s}e.afm=function(e="",i="extension",s=((e="")=>e),c={},o={}){const l=e.includes("\r")?"\r\n":"\n",f=e.match(/(?<!\\|\>\s*)```[^```]+\\?```(\r?\n)?/g)||[],p=Array.from(new Set(e.match(/\&#\w+;/g)||[])),a=p.map((e=>escape(e))),d=f.reduce(((e,t)=>e.replace(t,"")),t(e)),u=p.reduce(((e,t)=>e.replace(new RegExp(n(t),"g"),escape(t))),d),g=u.match(/(?!\r?\n)(\s+|\t+)?\>\[\!.*\r?\n((\s+|\t+)?\>(?!\[\!).*\r?\n?){1,}/g)||[],$=Object.keys(c).filter((e=>"VIDEO"===c[e]))[0]||"VIDEO",m=(u.match(new RegExp(`(?!\\r?\\n)(\\s+|\\t+)?\\>\\[\\!${$}\\]\\((.*)\\)`,"g"))||[]).map((e=>e.trim()));let h=t(e);for(const e of g){const t=e.split(/\r?\n/).filter((e=>e.length>0&&/[^\s]+/.test(e))),d=(t[0].match(/\>\[\!(.*)\]/)||[])[1]||"",u=t[0].replace(/\>\[.*/,""),g=`${l}${u}`,$=`${u}${s(t.slice(1,t.length).map((e=>{let t=e.replace(/^(\s+|\t+)?\>/,"").trim();for(const e of p)t.includes(e)&&(t=t.replace(new RegExp(n(e),"g"),escape(e)));return t})).filter(((e,t)=>0!==t||e.length>0)).join(l).trim()).split(/\r?\n/).join(g)}`,m=(d in c?c[d]:d).toLowerCase().replace(/\s/g,""),x=t.map((e=>{let t=e;for(const e of a)t.includes(e)&&(t=t.replace(new RegExp(n(e),"g"),unescape(e)));return t})).join(l);let v=h.indexOf(x);f.length>0&&(v=r(x,h,f,v)),h=`${h.slice(0,v)}${u}<div class="${i} ${m}">${g}<div>${d in o?o[d]:d}</div>${g}<div>${l}${$.replace(/\r?\n$/,"")}${g}</div>${g}</div>${g}${h.slice(v+x.length)}`}for(const e of m){const t=e.replace(/^.*\(|\).*$/g,"");let n=h.indexOf(e);f.length>0&&(n=r(e,h,f,n)),h=`${h.slice(0,n)}<div class="${i} video"><iframe allowfullscreen embedded-video src="${t}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"><source src="${t}" type="" /><p>Your browser does not support the iframe element.</p></iframe></div>${h.slice(n+e.length)}`}for(const e of a)h=h.replace(new RegExp(n(e),"g"),unescape(e));return h.trim()},Object.defineProperty(e,"__esModule",{value:!0})}));