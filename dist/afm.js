!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).afm={})}(this,(function(e){"use strict";function t(e=""){return e.replace(/[\-\[\]{}()*+?.,\\\^\$|#]/g,"\\$&")}function n(e="",t="",n=[],i=0){let r=0,s=i;const o=n.filter((t=>t.includes(e))).map((n=>{const i=t.indexOf(n,r)+n.indexOf(e);return i>r&&(r=i),i}));if(o.includes(s))for(;o.includes(s);)s=t.indexOf(e,s+1);return s}e.afm=function(e="",i="extension",r=((e="")=>e),s={},o={}){const l=e.includes("\r")?"\r\n":"\n",c=Array.from(new Set(e.match(/\&#\w+;/g)||[])),f=c.map((e=>escape(e))),p=e.split(/(?<!`)`{3,3}(?!`)/g),a=p.filter(((e,t)=>t%2==1)).map((e=>`\`\`\`${l}${e}${l}\`\`\``)),d=p.filter(((e,t)=>t%2==0)).join(l),u=c.reduce(((e,n)=>e.replace(new RegExp(t(n),"g"),escape(n))),d),$=u.match(/(?!\r?\n)(\s+|\t+)?\>\[\!.*\r?\n((\s+|\t+)?\>(?!\[\!).*\r?\n?){1,}/g)||[],g=Object.keys(s).filter((e=>"VIDEO"===s[e]))[0]||"VIDEO",m=u.match(new RegExp(`\\>\\[\\!${g}\\]\\((.*)\\)`,"g"))||[];let h=function(e=""){return JSON.parse(JSON.stringify(e))}(e);for(const e of $){const p=e.split(/\r?\n/).filter((e=>e.length>0&&/[^\s]+/.test(e))),d=(p[0].match(/\>\[\!(.*)\]/)||[])[1]||"",u=p[0].replace(/\>\[.*/,""),$=`${l}${u}`,g=`${u}${r(p.slice(1,p.length).map((e=>{let n=e.replace(/^(\s+|\t+)?\>/,"").trim();for(const e of c)n.includes(e)&&(n=n.replace(new RegExp(t(e),"g"),escape(e)));return n})).filter(((e,t)=>0!==t||e.length>0)).join(l).trim()).split(/\r?\n/).join($)}`,m=(d in s?s[d]:d).toLowerCase().replace(/\s/g,""),x=p.map((e=>{let n=e;for(const e of f)n.includes(e)&&(n=n.replace(new RegExp(t(e),"g"),unescape(e)));return n})).join(l);let v=h.indexOf(x);a.length>0&&(v=n(x,h,a,v)),h=`${h.slice(0,v)}${u}<div class="${i} ${m}">${$}<div>${d in o?o[d]:d}</div>${$}<div>${l}${g.replace(/\r?\n$/,"")}${$}</div>${$}</div>${$}${h.slice(v+x.length)}`}for(const e of m){const t=e.replace(/^.*\(|\).*$/g,"");let r=h.indexOf(e);a.length>0&&(r=n(e,h,a,r)),h=`${h.slice(0,r)}<div class="${i} video"><iframe allowfullscreen embedded-video src="${t}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"><source src="${t}" type="" /><p>Your browser does not support the iframe element.</p></iframe></div>${h.slice(r+e.length)}`}for(const e of f)h=h.replace(new RegExp(t(e),"g"),unescape(e));return h.trim()},Object.defineProperty(e,"__esModule",{value:!0})}));