function e(e){return JSON.parse(JSON.stringify(e))}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^\$|#]/g,"\\$&")}function r(r="",t="extension",i=((e="")=>e),s={},c={}){const l=r.includes("\r")?"\r\n":"\n",o=r.match(/(?<!\\|\>\s*)```[^```]+\\?```(\r?\n)?/g)||[],p=Array.from(new Set(r.match(/\&#\w+;/g)||[])),a=p.map((e=>escape(e))),f=o.reduce(((e,n)=>e.replace(n,"")),e(r)),d=p.reduce(((e,r)=>e.replace(new RegExp(n(r),"g"),escape(r))),f).match(/(?!\r?\n)(\s+|\t+)?\>\[\!.*\r?\n((\s+|\t+)?\>(?!\[\!).*\r?\n?){1,}/g)||[],u=Object.keys(s).filter((e=>"VIDEO"===s[e]))[0]||"VIDEO",$=new RegExp(`(?<!\`\`\`\\r?\\n(\\s+|\\t+)?)\\>\\[\\!${u}\\]\\((.*)\\)`,"g");let g=e(r);for(const e of d){const r=e.split(/\r?\n/).filter((e=>e.length>0&&/[^\s]+/.test(e))),f=(r[0].match(/\>\[\!(.*)\]/)||[])[1]||"",d=r[0].replace(/\>\[.*/,""),u=`${l}${d}`,$=`${d}${i(r.slice(1,r.length).map((e=>{let r=e.replace(/^(\s+|\t+)?\>/,"").trim();for(const e of p)r.includes(e)&&(r=r.replace(new RegExp(n(e),"g"),escape(e)));return r})).filter(((e,n)=>0!==n||e.length>0)).join(l).trim()).split(/\r?\n/).join(u)}`,m=(f in s?s[f]:f).toLowerCase().replace(/\s/g,""),h=r.map((e=>{let r=e;for(const e of a)r.includes(e)&&(r=r.replace(new RegExp(n(e),"g"),unescape(e)));return r})).join(l);let w=g.indexOf(h);if(o.length>0){let e=0;const n=o.filter((e=>e.includes(h))).map((n=>{const r=g.indexOf(n,e)+n.indexOf(h);return r>e&&(e=r),r}));if(n.includes(w))for(;n.includes(w);)w=g.indexOf(h,w+1)}g=`${g.slice(0,w)}${d}<div class="${t} ${m}">${u}<div>${f in c?c[f]:f}</div>${u}<div>${l}${$.replace(/\r?\n$/,"")}${u}</div>${u}</div>${u}${g.slice(w+h.length)}`}g=g.replace($,`<div class="${t} video"><iframe allowfullscreen embedded-video src="$2" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"><source src="$2" type="" /><p>Your browser does not support the iframe element.</p></iframe></div>`);for(const e of a)g=g.replace(new RegExp(n(e),"g"),unescape(e));return g.trim()}export{r as afm};