function e(e){return JSON.parse(JSON.stringify(e))}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^\$|#]/g,"\\$&")}function t(t="",n="extension",s=((e="")=>e),c={},i={}){const l=t.includes("\r")?"\r\n":"\n",o=t.match(/(?<!\\|\>\s*)```[^```]+\\?```(\r?\n)?/g)||[],p=Array.from(new Set(t.match(/\&#\w+;/g)||[])),a=p.map((e=>escape(e))),$=o.reduce(((e,r)=>e.replace(r,"")),e(t)),f=p.reduce(((e,t)=>e.replace(new RegExp(r(t),"g"),escape(t))),$).match(/(?!\r?\n)(\s+|\t+)?\>\[\!.*\r?\n((\s+|\t+)?\>(?!\[\!).*\r?\n?){1,}/g)||[],d=Object.keys(c).filter((e=>"VIDEO"===c[e]))[0]||"VIDEO",g=new RegExp(`(?<!\`\`\`\\r?\\n(\\s+|\\t+)?)\\>\\[\\!${d}\\]\\((.*)\\)`,"g");let u=e(t);for(const e of f){const t=e.split(/\r?\n/).filter((e=>e.length>0&&/[^\s]+/.test(e))),o=(t[0].match(/\>\[\!(.*)\]/)||[])[1]||"",$=t[0].replace(/\>\[.*/,""),f=`${l}${$}`,d=`${$}${s(t.slice(1,t.length).map((e=>{let t=e.replace(/^(\s+|\t+)?\>/,"").trim();for(const e of p)t.includes(e)&&(t=t.replace(new RegExp(r(e),"g"),escape(e)));return t})).filter(((e,r)=>0!==r||e.length>0)).join(l).trim()).split(/\r?\n/).join(f)}`,g=(o in c?c[o]:o).toLowerCase().replace(/\s/g,""),m=t.map((e=>{let t=e;for(const e of a)t.includes(e)&&(t=t.replace(new RegExp(r(e),"g"),unescape(e)));return t})).join(l),h=u.lastIndexOf(m);u=`${u.slice(0,h)}${$}<div class="${n} ${g}">${f}<div>${o in i?i[o]:o}</div>${f}<div>${l}${d.replace(/\r?\n$/,"")}${f}</div>${f}</div>${f}${u.slice(h+m.length)}`}u=u.replace(g,`<div class="${n} video"><iframe allowfullscreen embedded-video src="$2" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"><source src="$2" type="" /><p>Your browser does not support the iframe element.</p></iframe></div>`);for(const e of a)u=u.replace(new RegExp(r(e),"g"),unescape(e));return u.trim()}export{t as afm};