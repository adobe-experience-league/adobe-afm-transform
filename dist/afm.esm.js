function e(e=""){return e.replace(/[\-\[\]{}()*+?.,\\\^\$|#]/g,"\\$&")}function n(e="",n="",t=[],r=0){let i=0,s=r;const c=t.filter((n=>n.includes(e))).map((t=>{const r=n.indexOf(t,i)+t.indexOf(e);return r>i&&(i=r),r}));if(c.includes(s))for(;c.includes(s);)s=n.indexOf(e,s+1);return s}function t(t="",r="extension",i=((e="")=>e),s={},c={}){const l=t.includes("\r")?"\r\n":"\n",o=Array.from(new Set(t.match(/\&#\w+;/g)||[])),p=o.map((e=>escape(e))),a=[],f=t.split(/(?<!`)`{3,3}(?!`)/g).filter(((e,n)=>n%2==0)).join(l),d=o.reduce(((n,t)=>n.replace(new RegExp(e(t),"g"),escape(t))),f),$=d.match(/(?!\r?\n)(\s+|\t+)?\>\[\!.*\r?\n((\s+|\t+)?\>(?!\[\!).*\r?\n?){1,}/g)||[],g=Object.keys(s).filter((e=>"VIDEO"===s[e]))[0]||"VIDEO",u=d.match(new RegExp(`\\>\\[\\!${g}\\]\\((.*)\\)`,"g"))||[];let m=function(e=""){return JSON.parse(JSON.stringify(e))}(t);for(const t of $){const f=t.split(/\r?\n/).filter((e=>e.length>0&&/[^\s]+/.test(e))),d=(f[0].match(/\>\[\!(.*)\]/)||[])[1]||"",$=f[0].replace(/\>\[.*/,""),g=`${l}${$}`,u=`${$}${i(f.slice(1,f.length).map((n=>{let t=n.replace(/^(\s+|\t+)?\>/,"").trim();for(const n of o)t.includes(n)&&(t=t.replace(new RegExp(e(n),"g"),escape(n)));return t})).filter(((e,n)=>0!==n||e.length>0)).join(l).trim()).split(/\r?\n/).join(g)}`,h=(d in s?s[d]:d).toLowerCase().replace(/\s/g,""),x=f.map((n=>{let t=n;for(const n of p)t.includes(n)&&(t=t.replace(new RegExp(e(n),"g"),unescape(n)));return t})).join(l);let w=m.indexOf(x);a.length>0&&(w=n(x,m,a,w)),m=`${m.slice(0,w)}${$}<div class="${r} ${h}">${g}<div>${d in c?c[d]:d}</div>${g}<div>${l}${u.replace(/\r?\n$/,"")}${g}</div>${g}</div>${g}${m.slice(w+x.length)}`}for(const e of u){const t=e.replace(/^.*\(|\).*$/g,"");let i=m.indexOf(e);a.length>0&&(i=n(e,m,a,i)),m=`${m.slice(0,i)}<div class="${r} video"><iframe allowfullscreen embedded-video src="${t}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"><source src="${t}" type="" /><p>Your browser does not support the iframe element.</p></iframe></div>${m.slice(i+e.length)}`}for(const n of p)m=m.replace(new RegExp(e(n),"g"),unescape(n));return m.trim()}export{t as afm};